<!-- Product Detail Start -->
@model OnlineMarketPlace.Models.Product
@{
    var categoriesL = ViewData["CategoriesList"] as OnlineMarketPlace.Models.CategoriesList;
}
@* @Html.Partial("_SidebarPartial", categoriesL); *@

<div class="product-detail">

    <div class="container">
        <div class="row">
            <div class="col-lg-9">
                <div class="row align-items-center product-detail-top">
                    <div class="col-md-5">
                        <div class="product-slider-single">
                            <img src="~/images/@Model.Image" alt="Product Image">
                            
                        </div>
                    </div>
                    <div class="col-md-7">
                        <div class="product-content">
                            <div class="title"><h2>@Model.Name</h2></div>
                            <div class="price">@Model.Price</div>
                            <div class="details">
                                <p>
                                    <a href="#reviews" style="text-decoration: none; color: inherit;">
                                        @* @(((double)ViewData["AverageRating"]) > 0 ? ((double)ViewData["AverageRating"]).ToString("0.0") : "No ratings") *@
                                        4.9 <i class="fa fa-star"></i>
                                    </a>
                                    | <a href="#reviews" style="text-decoration: none; color: inherit;">
                                        @Model.RatingAndReviews.Count Review
                                    </a>
                                    | @Model.QuantitySold Selled
                                    | <span style="color: #007bff; cursor: pointer;">Report</span>
                                    
                                </p>
                                <p>Availability: @Model.Inventory</p>
                            </div>

                            <div class="quantity">
                                <h4>Quantity:</h4>
                                <div class="qty">
                                    <button class="btn-minus"><i class="fa fa-minus"></i></button>
                                    <input type="text" value="1">
                                    <button class="btn-plus"><i class="fa fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="action">
                                <a href="#"><i class="fa fa-cart-plus"></i></a>
                                <a href="#"><i class="fa fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row product-detail-bottom">
                    <div class="col-lg-12">
                        <ul class="nav nav-pills nav-justified">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="pill" href="#description">Description</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#specification">Shop Information</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#reviews">Reviews (@Model.RatingAndReviews.Count)</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div id="description" class="container tab-pane active">
                                <br>
                                <h4>Product description</h4>
                                <p>
                                    @Model.Description
                                </p>
                            </div>
                            <div id="specification" class="container tab-pane fade">
                                <br>
                                <h4>Shop Information</h4>
                                <ul>
                                    <li>Lorem ipsum dolor sit amet</li>
                                    <li>Lorem ipsum dolor sit amet</li>
                                    <li>Lorem ipsum dolor sit amet</li>
                                    <li>Lorem ipsum dolor sit amet</li>
                                    <li>Lorem ipsum dolor sit amet</li>
                                </ul>
                            </div>
                            <div id="reviews" class="container tab-pane fade">
                                <br>
                                <div class="reviews-submitted">
                                    <div class="reviewer">Phasellus Gravida - <span>01 Jan 2020</span></div>
                                    <div class="ratting">
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                    </div>
                                    @{
                                        var reviews = ViewData["rv"] as List<OnlineMarketPlace.Models.RatingAndReview>;
                                    }
                                    <p>
                                        @if (reviews != null && reviews.Any())
                                        {
                                        @* <p>@($"Found {reviews.Count} reviews.")</p> <!-- Hiển thị số lượng phần tử --> *@
                                        <ul>
                                                @foreach (RatingAndReview review in reviews)
                                                {
                                                <li>

                                                    @* <strong>Rating:</strong> @review.Rating <br /> *@
                                                    @* <strong>Review:</strong>  *@
                                                    @review.Review
                                                </li>
                                                }
                                        </ul>
                                        }
                                        else
                                        {
                                        <p>No reviews available.</p>
                                        }
                                    </p>
                                </div>
                                <div class="reviews-submit">
                                    <h4>Give your Review:</h4>
                                    <div class="ratting">
                                        <i class="fa fa-star-o"></i>
                                        <i class="fa fa-star-o"></i>
                                        <i class="fa fa-star-o"></i>
                                        <i class="fa fa-star-o"></i>
                                        <i class="fa fa-star-o"></i>
                                    </div>
                                    <div class="row form">
                                        <div class="col-sm-6">
                                            <input type="text" placeholder="Name">
                                        </div>
                                        <div class="col-sm-6">
                                            <input type="email" placeholder="Email">
                                        </div>
                                        <div class="col-sm-12">
                                            <textarea placeholder="Review"></textarea>
                                        </div>
                                        <div class="col-sm-12">
                                            <button>Submit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container">
                    <div class="section-header">
                        <h3>Related Products</h3>
                    </div>
                </div>



                @{
                    var relatedProducts = ViewData["RelatedProducts"] as List<OnlineMarketPlace.Models.Product>;
                    var currentProduct = Model as OnlineMarketPlace.Models.Product;
                    var itemsPerPage = 4;
                    var currentPage = 1;
                    int.TryParse(Context.Request.Query["page"], out currentPage);
                    if (currentPage < 1) currentPage = 1;
                }

                @if (relatedProducts != null && relatedProducts.Any(p => p.Id != currentProduct.Id))
                {
                    var filteredProducts = relatedProducts.Where(p => p.Id != currentProduct.Id).ToList();
                    var totalPages = Math.Ceiling((decimal)filteredProducts.Count / itemsPerPage);
                    var displayProducts = filteredProducts.Skip((currentPage - 1) * itemsPerPage).Take(itemsPerPage);

                    <div class="row align-items-center product-slider product-slider-3">
                        @foreach (var product in displayProducts)
                        {
                            <div class="col-lg-3">
                                <div class="product-item">
                                    <div class="product-image">
                                        <a href="product-detail.html">
                                            <img src="~/images/product-1.png" alt="Product Image">
                                        </a>
                                        <div class="product-action">
                                            <a href="#"><i class="fa fa-cart-plus"></i></a>
                                            <a href="#"><i class="fa fa-heart"></i></a>
                                            <a href="#"><i class="fa fa-search"></i></a>
                                        </div>
                                    </div>
                                    <div class="product-content">
                                        <div class="title"><a href="#">@product.Name</a></div>
                                        <div class="price">$@product.Price</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (totalPages > 1)
                    {
                        <div class="row mt-4">
                            <div class="col-12">
                                <ul class="pagination justify-content-center">
                                    @for (int i = 1; i <= totalPages; i++)
                                    {
                                        <li class="page-item @(i == currentPage ? "active" : "")">
                                            <a class="page-link" href="?page=@i">@i</a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="row">
                        <div class="col-12 text-center">
                            <p>No related product</p>
                        </div>
                    </div>
                }

            </div>

            
            <!-- siderbar -->
            <div class="col-sm-3">
                @Html.Partial("_SidebarPartial", categoriesL)
            </div>
        </div>
    </div>
</div>
<!-- Product Detail End -->