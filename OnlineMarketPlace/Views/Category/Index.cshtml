@{

    ViewData["Title"] = "Danh mục sản phẩm";
    var categories = ViewData["CategoriesList"] as OnlineMarketPlace.Models.CategoriesList;
    var products = ViewData["Products"] as List<OnlineMarketPlace.Models.Product>;
    int totalProducts = ViewData["TotalProducts"] is int total ? total : 0;
    int limit = ViewData["Limit"] != null ? Convert.ToInt32(ViewData["Limit"]) : 10;
}
<!-- Product List Start -->
<div class="product-view">
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                @Html.Partial("_SidebarPartial", categories)
            </div>
            <!-- Phần sản phẩm -->
            <div class="col-md-9">
                <div class="row mb-4">
                    <div class="col-lg-12">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                               
                            </div>
                            <div class="col-md-4" style="margin-bottom: 12px;">
                                <div class="product-short text-right">
                                    <div class="dropdown">
                                        <a href="#" class="dropdown-toggle btn btn-secondary" data-toggle="dropdown">Sort by =></a>
                                        <div class="dropdown-content dropdown-menu dropdown-menu-right">
                                            <button class="dropdown-item" onclick="sortProducts('price-asc')">Price: Low to High</button>
                                            <button class="dropdown-item" onclick="sortProducts('price-desc')">Price: High to Low</button>
                                            <button class="dropdown-item" onclick="sortProducts('name-asc')">Name: A to Z</button>
                                            <button class="dropdown-item" onclick="sortProducts('name-desc')">Name: Z to A</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        function sortProducts(sortBy) {
                            var categoryId = "@ViewData["CategoryId"]";
                            var selectedPrice = "@ViewData["SelectedPrice"]";
                            var searchString = "@ViewData["SearchString"]";
                            var url = `/Category/Sort?sortBy=${sortBy}`;
                            
                            if (categoryId) {
                                url += `&categoryId=${categoryId}`;
                            }
                            if (selectedPrice) {
                                url += `&price=${selectedPrice}`;
                            }
                            if (searchString) {
                                url += `&searchString=${searchString}`;
                            }
                            
                            window.location.href = url;
                        }
                    </script>
                    <!-- Danh sách sản phẩm -->
                    <div class="row">
                        @if (products != null && products.Any())
                        {
                            @foreach (var product in products)
                            {
                                <div class="col-lg-4 col-md-6 mb-4">
                                    <div class="product-item card">
                                        <div class="product-image">
                                            <a href="/Product/Detail/@product.Id">
                                                @if (!string.IsNullOrEmpty(product.Image))
                                                {
                                                    <img src="@product.Image" alt="@product.Name" class="img-fluid">
                                                }
                                                else
                                                {
                                                    <img src="/images/default-product.jpg" alt="@product.Name" class="img-fluid">
                                                }
                                            </a>
                                            <div class="product-action">
                                                <a href="#" class="btn btn-outline-primary"><i class="fa fa-cart-plus"></i></a>
                                                <a href="#" class="btn btn-outline-secondary"><i class="fa fa-heart"></i></a>
                                                <a href="#" class="btn btn-outline-info"><i class="fa fa-search"></i></a>
                                            </div>
                                        </div>
                                        <div class="product-content">
                                            <div class="title"><a href="/Product/Details/@product.Id">@product.Name</a></div>
                                            <div class="price">$ @product.Price </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="col-12 text-center">
                                <p>Không tìm thấy sản phẩm nào.</p>
                            </div>
                        }
                        @if (totalProducts > limit)
                        {
                            <form method="get" action="@Url.Action("FilterByPriceRange", "Category")" class="text-center mt-4">
                                <input type="hidden" name="limit" value="@(limit + 9)" />
                                @if (ViewData["CategoryId"] != null)
                                {
                                    <input type="hidden" name="categoryId" value="@ViewData["CategoryId"]" />
                                }
                                @if (ViewData["SelectedPrice"] != null)
                                {
                                    <input type="hidden" name="price" value="@ViewData["SelectedPrice"]" />
                                }
                                <button type="submit" class="btn btn-outline-primary btn-lg">See more</button>
                            </form>
                        }
                    </div>
                   
                </div>
            </div>
        </div>
</div>
</div>
<script>
    function sortProducts(sortBy) {
    var categoryId = "@ViewData["CategoryId"]";
    var selectedPrice = "@ViewData["SelectedPrice"]";
    var searchString = "@ViewData["SearchString"]";
    var url = `/Category/Sort?sortBy=${sortBy}`;
    
    if (categoryId) {
        url += `&categoryId=${categoryId}`;
    }
    if (selectedPrice) {
        url += `&price=${selectedPrice}`;
    }
    if (searchString) {
        url += `&searchString=${searchString}`;
    }
    
    window.location.href = url;
}
</script>
<!-- Product List End -->